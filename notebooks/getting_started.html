
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Getting started &#8212; Formulae 0.2.0 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api_reference.html" />
    <link rel="prev" title="Dependencies" href="../index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/formulae_small.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Getting started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api_reference.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../internals.html">
  Internals
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/bambinos/formulae" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/formulae/" rel="noopener" target="_blank" title="PyPi">
            <span><i class="fas fa-box"></i></span>
            <label class="sr-only">PyPi</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#User-guide">
   User guide
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Creating-and-accessing-design-matrices">
   Creating and accessing design matrices
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Categorical-predictors">
   Categorical predictors
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Adding-interactions">
   Adding interactions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Function-calls">
   Function calls
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Built-in-transformations">
   Built-in transformations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Suppresing-the-default-intercept">
     Suppresing the default intercept
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Operations-between-terms">
   Operations between terms
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Categorical-responses">
   Categorical responses
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Group-specific-effects">
   Group-specific effects
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Evaluating-new-data">
   Evaluating new data
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Getting-started">
<h1>Getting started<a class="headerlink" href="#Getting-started" title="Permalink to this headline">¶</a></h1>
<p>formulae requires a working Python interpreter (3.7+) and the libraries NumPy, SciPy and pandas with versions specified in the <a class="reference external" href="https://github.com/bambinos/formulae/blob/master/requirements.txt">requirements.txt</a> file.</p>
<p>Assuming a standard Python environment is installed on your machine (including pip), the latest release of formulae can be installed in one line using pip:</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">formulae</span></code></p>
<p>Alternatively, if you want the development version of the package you can install from GitHub:</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">git+https://github.com/bambinos/formulae.git</span></code></p>
<section id="User-guide">
<h2>User guide<a class="headerlink" href="#User-guide" title="Permalink to this headline">¶</a></h2>
<p>The main function is <code class="docutils literal notranslate"><span class="pre">design_matrices()</span></code>. It takes a model formula and a pandas DataFrame and returns an object of class <code class="docutils literal notranslate"><span class="pre">DesignMatrices</span></code> that contains information about the response, the common effects, and the group specific effects that can be accessed with the attributes <code class="docutils literal notranslate"><span class="pre">.response</span></code>, <code class="docutils literal notranslate"><span class="pre">.common</span></code>, and <code class="docutils literal notranslate"><span class="pre">.group</span></code> respectively.</p>
<p>Model formulas are much like the very famous model formulas in the R programming language. The extension to group-specific effects is similar to the extension provided by the <a class="reference external" href="https://CRAN.R-project.org/package=lme4">lme4</a> package, also in R.</p>
</section>
<section id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import numpy as np
import pandas as pd

from formulae import design_matrices
</pre></div>
</div>
</div>
<p>Let’s simulate some data to use throughout examples here. The number of observations isn’t too important. We keep it low to understand what is going on more easily. However, we do include both numeric and categoric variables to see how formulae handles these types in different scenarios.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>rng = np.random.default_rng(7355608)
SIZE = 10
data = pd.DataFrame(
    {
        &quot;y1&quot;: rng.normal(size=SIZE),
        &quot;y2&quot;: rng.choice([&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], size=SIZE),
        &quot;x&quot;: rng.normal(size=SIZE),
        &quot;z&quot;: rng.choice([1, 2, 3], size=SIZE),
        &quot;g&quot;: rng.choice([&quot;Group 1&quot;, &quot;Group 2&quot;, &quot;Group 3&quot;], size=SIZE),
    }
)
data
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>y1</th>
      <th>y2</th>
      <th>x</th>
      <th>z</th>
      <th>g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.200521</td>
      <td>C</td>
      <td>-0.351447</td>
      <td>3</td>
      <td>Group 2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.421306</td>
      <td>B</td>
      <td>-0.431129</td>
      <td>3</td>
      <td>Group 1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.490128</td>
      <td>B</td>
      <td>-0.412738</td>
      <td>2</td>
      <td>Group 2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.929507</td>
      <td>B</td>
      <td>0.574337</td>
      <td>3</td>
      <td>Group 2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.515838</td>
      <td>A</td>
      <td>1.561390</td>
      <td>3</td>
      <td>Group 1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>-1.180238</td>
      <td>A</td>
      <td>-0.357137</td>
      <td>1</td>
      <td>Group 2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-1.839936</td>
      <td>C</td>
      <td>-0.453278</td>
      <td>3</td>
      <td>Group 3</td>
    </tr>
    <tr>
      <th>7</th>
      <td>-0.330336</td>
      <td>B</td>
      <td>-0.039111</td>
      <td>3</td>
      <td>Group 2</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.797019</td>
      <td>A</td>
      <td>1.882748</td>
      <td>2</td>
      <td>Group 2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-0.030036</td>
      <td>A</td>
      <td>0.549615</td>
      <td>3</td>
      <td>Group 3</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Creating-and-accessing-design-matrices">
<h2>Creating and accessing design matrices<a class="headerlink" href="#Creating-and-accessing-design-matrices" title="Permalink to this headline">¶</a></h2>
<p>Let’s create a <code class="docutils literal notranslate"><span class="pre">DesignMatrices</span></code> object with a numeric response and a numeric predictor. The first argument we pass is the model formula, and the second is the data frame where we take variables from.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;y1 ~ x&quot;, data)
</pre></div>
</div>
</div>
<p>Under <code class="docutils literal notranslate"><span class="pre">dm.common</span></code> we find an object of class <code class="docutils literal notranslate"><span class="pre">CommonEffectsMatrix</span></code> which stores the design matrix for the common part of the model, as well as other information about the terms in the matrix.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm.common
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CommonEffectsMatrix(
  shape: (10, 2),
  terms: {
    &#39;Intercept&#39;: {
      type: intercept,
      cols: slice(0, 1, None),
      full_names: [&#39;Intercept&#39;]
    },
    &#39;x&#39;: {
      type: numeric,
      cols: slice(1, 2, None),
      full_names: [&#39;x&#39;]
    }
  }
)
</pre></div></div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">.design_matrix</span></code> to obtain the design matrix for the common part of the model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm.common.design_matrix
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[ 1.        , -0.351447  ],
       [ 1.        , -0.43112895],
       [ 1.        , -0.41273793],
       [ 1.        ,  0.57433652],
       [ 1.        ,  1.56139001],
       [ 1.        , -0.35713698],
       [ 1.        , -0.45327849],
       [ 1.        , -0.03911089],
       [ 1.        ,  1.88274763],
       [ 1.        ,  0.54961543]])
</pre></div></div>
</div>
<p>Or call the <code class="docutils literal notranslate"><span class="pre">.as_dataframe()</span></code> method to return a data frame.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-0.351447</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-0.431129</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.412738</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.574337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>1.561390</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Note the response term can be omitted and we still obtain the design matrix for the common predictors</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;x&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-0.351447</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-0.431129</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.412738</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.574337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>1.561390</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Categorical-predictors">
<h2>Categorical predictors<a class="headerlink" href="#Categorical-predictors" title="Permalink to this headline">¶</a></h2>
<p>Variables with categorical type in the data frame are recognized and handled as such. If there’s a numerical variable that should be interpreted as categorical and you don’t want to manipulate your data manually, you can wrap the name of the variable with <code class="docutils literal notranslate"><span class="pre">C()</span></code>, like <code class="docutils literal notranslate"><span class="pre">C(variable)</span></code>, and formulae will convert it to the categorical type.</p>
<p>Categorical predictors are encoded using reference level encoding (i.e. the first level is taken as baseline). This way, the resulting design matrix is of full-rank.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;g&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>g[Group 2]</th>
      <th>g[Group 3]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>But if we don’t have an intercept term, there’s no need to use reference encoding for the categorical variables to avoid linear dependencies between the columns and formulae uses cell-means encoding.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;0 + g&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>g[Group 1]</th>
      <th>g[Group 2]</th>
      <th>g[Group 3]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Suppose that <code class="docutils literal notranslate"><span class="pre">z</span></code> actually represents a certain categorization represented by numbers. We can use <code class="docutils literal notranslate"><span class="pre">&quot;y1</span> <span class="pre">~</span> <span class="pre">C(z)&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">z</span></code> will be internally interpreted as categorical instead of numeric.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;C(z)&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>C(z)[2]</th>
      <th>C(z)[3]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">C()</span></code> wrapper takes the first level as the reference level (after being sorted with <code class="docutils literal notranslate"><span class="pre">sorted()</span></code>), but we can override this by passing a list with a custom ordering.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># 2 is taken as baseline, and then it comes 3 and 1.
lvl = [2, 3, 1]
dm = design_matrices(&quot;C(z, levels=lvl)&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>C(z, levels = lvl)[3]</th>
      <th>C(z, levels = lvl)[1]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">C()</span></code> also allows us to change only the reference level. In the next chunk of code we use <code class="docutils literal notranslate"><span class="pre">C(z,</span> <span class="pre">2)</span></code> to indicate that we want <code class="docutils literal notranslate"><span class="pre">2</span></code> to be the reference level, and leave all the other levels as default.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;C(z, 2)&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>C(z, 2)[1]</th>
      <th>C(z, 2)[3]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Finally, if we want to convert one variable into a binary variable, we can use the internal <code class="docutils literal notranslate"><span class="pre">binary()</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;binary(z, 2)&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>binary(z, 2)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>which also works for categorical variables</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;binary(g, &#39;Group 1&#39;)&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>binary(g, Group 1)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Adding-interactions">
<h2>Adding interactions<a class="headerlink" href="#Adding-interactions" title="Permalink to this headline">¶</a></h2>
<p>The interaction operator is <code class="docutils literal notranslate"><span class="pre">:</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;x:z&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>x:z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-1.054341</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-1.293387</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.825476</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.723010</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>4.684170</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">*</span></code> operator is known as the full interaction operator because <code class="docutils literal notranslate"><span class="pre">x*z</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">+</span> <span class="pre">z</span> <span class="pre">+</span> <span class="pre">x:z</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;x*z&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>x</th>
      <th>z</th>
      <th>x:z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-0.351447</td>
      <td>3.0</td>
      <td>-1.054341</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-0.431129</td>
      <td>3.0</td>
      <td>-1.293387</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.412738</td>
      <td>2.0</td>
      <td>-0.825476</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.574337</td>
      <td>3.0</td>
      <td>1.723010</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>1.561390</td>
      <td>3.0</td>
      <td>4.684170</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>And both interaction operators can be used with mixtures of numerical and categorical variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;0 + x*g&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>g[Group 1]</th>
      <th>g[Group 2]</th>
      <th>g[Group 3]</th>
      <th>x:g[Group 2]</th>
      <th>x:g[Group 3]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.351447</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>-0.351447</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.431129</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-0.000000</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.412738</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>-0.412738</td>
      <td>-0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.574337</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.574337</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.561390</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Function-calls">
<h2>Function calls<a class="headerlink" href="#Function-calls" title="Permalink to this headline">¶</a></h2>
<p>A term does not need to be just a variable in a data frame. It can also be the result of a function call. Formulae allows you to built-in functions as well as functions available from the top-level environment where <code class="docutils literal notranslate"><span class="pre">design_matrices</span></code> is being called.</p>
<p>Since we’ve loaded the NumPy library as <code class="docutils literal notranslate"><span class="pre">np</span></code>, we can access its namespace as we would do in regular Python code.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;np.exp(x)&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>np.exp(x)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.703669</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.649775</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.661836</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>1.775952</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>4.765441</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can also use our own custom functions</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>def add(x, how_much):
    return x + how_much

dm = design_matrices(&quot;add(x, 10)&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>add(x, 10)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>9.648553</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>9.568871</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>9.587262</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>10.574337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>11.561390</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Or even nested function calls!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;add(np.exp(x), 5)&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>add(np.exp(x), 5)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>5.703669</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>5.649775</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>5.661836</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>6.775952</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>9.765441</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Built-in-transformations">
<h2>Built-in transformations<a class="headerlink" href="#Built-in-transformations" title="Permalink to this headline">¶</a></h2>
<p>Formulae comes with some built-in transformations that come very handy when doing statistical modeling. These functions are</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">center()</span></code>: Centers the variable around its mean.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale()</span></code>: Centers the variable around its mean and divides it by its standard deviation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">standardize()</span></code>: An alias for <code class="docutils literal notranslate"><span class="pre">scale()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bs()</span></code>: Create a Basis Spline, a.k.a. B-Spline.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;scale(x)&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>scale(x)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-0.732600</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-0.829284</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.806969</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.390720</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>1.588384</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># check mean is 0 and std is 1
print(np.std(dm.common.as_dataframe()[&quot;scale(x)&quot;]))
print(np.mean(dm.common.as_dataframe()[&quot;scale(x)&quot;]))
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.0
-2.2204460492503132e-17
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;bs(x, df=6)&quot;, data)
dm.common.as_dataframe()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>bs(x, df = 6)[0]</th>
      <th>bs(x, df = 6)[1]</th>
      <th>bs(x, df = 6)[2]</th>
      <th>bs(x, df = 6)[3]</th>
      <th>bs(x, df = 6)[4]</th>
      <th>bs(x, df = 6)[5]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.281092</td>
      <td>0.655237</td>
      <td>0.063433</td>
      <td>0.000237</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.703742</td>
      <td>0.086820</td>
      <td>0.000757</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.737838</td>
      <td>0.240873</td>
      <td>0.004644</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.359380</td>
      <td>0.502344</td>
      <td>0.138276</td>
      <td>1.039084e-07</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.005325</td>
      <td>0.092999</td>
      <td>0.470374</td>
      <td>4.313026e-01</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>0.312950</td>
      <td>0.631876</td>
      <td>0.055013</td>
      <td>0.000161</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.296984</td>
      <td>0.611161</td>
      <td>0.090700</td>
      <td>0.001155</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000e+00</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.000008</td>
      <td>0.380123</td>
      <td>0.494494</td>
      <td>0.125375</td>
      <td>0.000000e+00</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>These transformations are known as <strong>stateful transformations</strong> because they remember the original values of parameters involved in the transformation (the mean and the standard deviation). This feature is critical when one wants to derive a design matrix based on new data, as required when evaluating the fit of a model on a new dataset.</p>
<section id="Suppresing-the-default-intercept">
<h3>Suppresing the default intercept<a class="headerlink" href="#Suppresing-the-default-intercept" title="Permalink to this headline">¶</a></h3>
<p>By default, formulae includes an intercept in the resulting desing matrix. But this can be ommited. Just add a <code class="docutils literal notranslate"><span class="pre">0</span></code> to the model formula as in the following example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;0 + x&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.351447</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.431129</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.412738</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.574337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.561390</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&quot;y1</span> <span class="pre">~</span> <span class="pre">-1</span> <span class="pre">+</span> <span class="pre">x&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;y1</span> <span class="pre">~</span> <span class="pre">x</span> <span class="pre">-</span> <span class="pre">1&quot;</span></code> are equivalent alternatives.</p>
</section>
</section>
<section id="Operations-between-terms">
<h2>Operations between terms<a class="headerlink" href="#Operations-between-terms" title="Permalink to this headline">¶</a></h2>
<p>It is possible someone wants to use a term that is the result of adding two other terms, such as <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">+</span> <span class="pre">z</span></code>. However, if we do <code class="docutils literal notranslate"><span class="pre">&quot;y</span> <span class="pre">~</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">z&quot;</span></code>, formulae will understand we want a model with two predictor terms, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and <code class="docutils literal notranslate"><span class="pre">z</span></code>. Fortunately, there are two (equivalent) ways of telling formulae that we want a term that is the result of performing operations between other terms. This can be achieved either by using the <code class="docutils literal notranslate"><span class="pre">I()</span></code> wrapper or its shorthand <code class="docutils literal notranslate"><span class="pre">{}</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;I(x + z)&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>I(x + z)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>2.648553</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>2.568871</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>1.587262</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>3.574337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>4.561390</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;{x / z}&quot;, data)
dm.common.as_dataframe().head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>I(x / z)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-0.117149</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-0.143710</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.206369</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.191446</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.520463</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As you may have noticed, the output shows <code class="docutils literal notranslate"><span class="pre">I()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">{}</span></code>. That’s because <code class="docutils literal notranslate"><span class="pre">{}</span></code> is translated into <code class="docutils literal notranslate"><span class="pre">I()</span></code> internally.</p>
</section>
<section id="Categorical-responses">
<h2>Categorical responses<a class="headerlink" href="#Categorical-responses" title="Permalink to this headline">¶</a></h2>
<p>Formulae can work with categorical responses with 2 or more levels. When the variable contains only two levels, formulae flags it as binary.</p>
<p>Recall <code class="docutils literal notranslate"><span class="pre">y2</span></code> is a categorical variable with levels <code class="docutils literal notranslate"><span class="pre">A</span></code>, <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">C</span></code>. In this case, formulae will interpret <code class="docutils literal notranslate"><span class="pre">A</span></code> as the reference level and will set the <code class="docutils literal notranslate"><span class="pre">binary</span></code> flag to <code class="docutils literal notranslate"><span class="pre">False</span></code> since this variable contains more than two categories.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;y2 ~ x&quot;, data)
dm.response
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ResponseVector(
  name: y2,
  type: categoric,
  length: 10,
  levels: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;],
  binary: False,
  baseline: A
)
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.design_vector</span></code> array is a column vector with the indexes of the levels as they appear in the variable.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm.response.design_vector
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[2],
       [1],
       [1],
       [1],
       [0],
       [0],
       [2],
       [1],
       [0],
       [0]], dtype=int8)
</pre></div></div>
</div>
<p>It is also possible to override the default behavior and indicate the reference level with some syntax sugar. If you say <code class="docutils literal notranslate"><span class="pre">response[level]</span></code>, formulae will interpret <code class="docutils literal notranslate"><span class="pre">response</span></code> as a binary variable and set the <code class="docutils literal notranslate"><span class="pre">'level'</span></code> category as reference. For example</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;y2[B] ~ x&quot;, data)
dm.response
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ResponseVector(
  name: y2,
  type: categoric,
  length: 10,
  levels: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;],
  binary: True,
  success: B
)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># &#39;y2&#39; is equal to B in four cases
dm.response.design_vector
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0],
       [1],
       [1],
       [1],
       [0],
       [0],
       [0],
       [1],
       [0],
       [0]])
</pre></div></div>
</div>
<p>If it is the case that the reference level contains spaces, we can wrap the response within quotes:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;g[&#39;Group 3&#39;] ~ x&quot;, data)
dm.response
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ResponseVector(
  name: g,
  type: categoric,
  length: 10,
  levels: [&#39;Group 1&#39;, &#39;Group 2&#39;, &#39;Group 3&#39;],
  binary: True,
  success: Group 3
)
</pre></div></div>
</div>
<p>As with the predictors, the <code class="docutils literal notranslate"><span class="pre">binary()</span></code> function can be used on the LHS as well</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;binary(g, &#39;Group 3&#39;) ~ x&quot;, data)
dm.response
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ResponseVector(
  name: binary(g, Group 3),
  type: numeric,
  length: 10
)
</pre></div></div>
</div>
<p>Note <code class="docutils literal notranslate"><span class="pre">binary()</span></code> outputs a numeric variable, so the response is recognized as numeric instead of categoric.</p>
</section>
<section id="Group-specific-effects">
<h2>Group-specific effects<a class="headerlink" href="#Group-specific-effects" title="Permalink to this headline">¶</a></h2>
<p>formulae also handles group-specific effects. They are specified using the pipe operator <code class="docutils literal notranslate"><span class="pre">|</span></code>, similar to the <a class="reference external" href="https://CRAN.R-project.org/package=lme4">lme4</a> R package. These terms are of the form <code class="docutils literal notranslate"><span class="pre">(expr|factor)</span></code> where the <code class="docutils literal notranslate"><span class="pre">expr</span></code> represents the effect and <code class="docutils literal notranslate"><span class="pre">factor</span></code> the group. <a class="reference external" href="https://cran.r-project.org/web/packages/lme4/vignettes/lmer.pdf">This vignette</a> from lme4 provides much better information on how this notation works. In a nutshell, group-specific intercepts are specified via
<code class="docutils literal notranslate"><span class="pre">(1|group)</span></code> and group-specific slopes are specified via <code class="docutils literal notranslate"><span class="pre">(variable|group)</span></code>. The latter also adds a group-specific intercept by default. This can be overriden doing <code class="docutils literal notranslate"><span class="pre">(0</span> <span class="pre">+</span> <span class="pre">variable|group)</span></code>.</p>
<p>First, let’s see a formula specifying a common predictor, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and a group-specific intercept for each level of <code class="docutils literal notranslate"><span class="pre">g</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;y1 ~ x + (1|g)&quot;, data)
dm.group
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GroupEffectsMatrix(
  shape: (10, 3),
  terms: {
    &#39;1|g&#39;: {
      type: intercept,
      groups: [&#39;Group 1&#39;, &#39;Group 2&#39;, &#39;Group 3&#39;],
      full_names: [&#39;1|g[Group 1]&#39;, &#39;1|g[Group 2]&#39;, &#39;1|g[Group 3]&#39;],
      cols: slice(0, 3, None)
    }
  }
)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm.common.as_dataframe()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>x</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-0.351447</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-0.431129</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.412738</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.574337</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>1.561390</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>-0.357137</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.0</td>
      <td>-0.453278</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.0</td>
      <td>-0.039111</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.0</td>
      <td>1.882748</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.0</td>
      <td>0.549615</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm.group.design_matrix
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0., 1., 0.],
       [1., 0., 0.],
       [0., 1., 0.],
       [0., 1., 0.],
       [1., 0., 0.],
       [0., 1., 0.],
       [0., 0., 1.],
       [0., 1., 0.],
       [0., 1., 0.],
       [0., 0., 1.]])
</pre></div></div>
</div>
<p>If we now use <code class="docutils literal notranslate"><span class="pre">(x|g)</span></code> we get both the group-specific slope, as well as the intercept, because it is included by default.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;y1 ~ x + (x|g)&quot;, data)
dm.group
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GroupEffectsMatrix(
  shape: (10, 6),
  terms: {
    &#39;1|g&#39;: {
      type: intercept,
      groups: [&#39;Group 1&#39;, &#39;Group 2&#39;, &#39;Group 3&#39;],
      full_names: [&#39;1|g[Group 1]&#39;, &#39;1|g[Group 2]&#39;, &#39;1|g[Group 3]&#39;],
      cols: slice(0, 3, None)
    },
    &#39;x|g&#39;: {
      type: numeric,
      groups: [&#39;Group 1&#39;, &#39;Group 2&#39;, &#39;Group 3&#39;],
      full_names: [&#39;x|g[Group 1]&#39;, &#39;x|g[Group 2]&#39;, &#39;x|g[Group 3]&#39;],
      cols: slice(3, 6, None)
    }
  }
)
</pre></div></div>
</div>
<p>We can access the different sub-matrices corresponding to each term as follows</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm.group[&quot;1|g&quot;] # same as before
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0., 1., 0.],
       [1., 0., 0.],
       [0., 1., 0.],
       [0., 1., 0.],
       [1., 0., 0.],
       [0., 1., 0.],
       [0., 0., 1.],
       [0., 1., 0.],
       [0., 1., 0.],
       [0., 0., 1.]])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm.group[&quot;x|g&quot;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[-0.        , -0.351447  , -0.        ],
       [-0.43112895, -0.        , -0.        ],
       [-0.        , -0.41273793, -0.        ],
       [ 0.        ,  0.57433652,  0.        ],
       [ 1.56139001,  0.        ,  0.        ],
       [-0.        , -0.35713698, -0.        ],
       [-0.        , -0.        , -0.45327849],
       [-0.        , -0.03911089, -0.        ],
       [ 0.        ,  1.88274763,  0.        ],
       [ 0.        ,  0.        ,  0.54961543]])
</pre></div></div>
</div>
<p>But as with the common part, this default intercept can be removed</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;y1 ~ x + (0 + x|g)&quot;, data)
dm.group # note there is no 1|x in the terms
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GroupEffectsMatrix(
  shape: (10, 3),
  terms: {
    &#39;x|g&#39;: {
      type: numeric,
      groups: [&#39;Group 1&#39;, &#39;Group 2&#39;, &#39;Group 3&#39;],
      full_names: [&#39;x|g[Group 1]&#39;, &#39;x|g[Group 2]&#39;, &#39;x|g[Group 3]&#39;],
      cols: slice(0, 3, None)
    }
  }
)
</pre></div></div>
</div>
<p>As a final remark, we note that the <code class="docutils literal notranslate"><span class="pre">expr</span></code> part of a group-specific can also be a categorical variable or an interaction. Similar rules apply for the <code class="docutils literal notranslate"><span class="pre">factor</span></code> part.</p>
</section>
<section id="Evaluating-new-data">
<h2>Evaluating new data<a class="headerlink" href="#Evaluating-new-data" title="Permalink to this headline">¶</a></h2>
<p>Both <code class="docutils literal notranslate"><span class="pre">CommonEffectsMatrix</span></code> and <code class="docutils literal notranslate"><span class="pre">GroupEffectsMatrix</span></code> are provided with a method that receives a data frame, with the same structure as the original data frame, and returns a new design matrix.</p>
<p>Suppose we have measured three variables, <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">g</span></code> on some subjects. <code class="docutils literal notranslate"><span class="pre">y</span></code> and <code class="docutils literal notranslate"><span class="pre">x</span></code> are numerics, while <code class="docutils literal notranslate"><span class="pre">g</span></code> is a categorical variable that represents some grouping. We also have a model with a common slope, and both varying intercepts and slopes, where we want to standardize the numeric predictor before entering the model. The formula would be <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">~</span> <span class="pre">scale(x)</span> <span class="pre">+</span> <span class="pre">(scale(x)|g)</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>data = pd.DataFrame({
    &quot;y&quot;: rng.normal(size=50),
    &quot;x&quot;: rng.normal(loc=200, scale=20, size=50),
    &quot;g&quot;: rng.choice([&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], size=50)
})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>dm = design_matrices(&quot;y ~ scale(x) + (scale(x)|g)&quot;, data)
print(dm.common)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CommonEffectsMatrix(
  shape: (50, 2),
  terms: {
    &#39;Intercept&#39;: {
      type: intercept,
      cols: slice(0, 1, None),
      full_names: [&#39;Intercept&#39;]
    },
    &#39;scale(x)&#39;: {
      type: numeric,
      cols: slice(1, 2, None),
      full_names: [&#39;scale(x)&#39;]
    }
  }
)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>print(dm.group)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GroupEffectsMatrix(
  shape: (50, 6),
  terms: {
    &#39;1|g&#39;: {
      type: intercept,
      groups: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;],
      full_names: [&#39;1|g[A]&#39;, &#39;1|g[B]&#39;, &#39;1|g[C]&#39;],
      cols: slice(0, 3, None)
    },
    &#39;scale(x)|g&#39;: {
      type: numeric,
      groups: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;],
      full_names: [&#39;scale(x)|g[A]&#39;, &#39;scale(x)|g[B]&#39;, &#39;scale(x)|g[C]&#39;],
      cols: slice(3, 6, None)
    }
  }
)
</pre></div></div>
</div>
<p>And now suppose we have new data for a set of new subjects. We can derive both common and group-specific design matrices for these new individuals without having to specify the model again. We can instead use the <code class="docutils literal notranslate"><span class="pre">._evaluate_new_data()</span></code> method. This method takes a data frame and returns either a new <code class="docutils literal notranslate"><span class="pre">CommonEffectsMatrix</span></code> or a new <code class="docutils literal notranslate"><span class="pre">GroupEffectsMatrix</span></code> depending on which object the method was called.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>data2 = pd.DataFrame({
    &quot;x&quot;: rng.normal(loc=180, scale=20,size=10),
    &quot;g&quot;: rng.choice([&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], size=10)
})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>common_new = dm.common._evaluate_new_data(data2)
common_new
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CommonEffectsMatrix(
  shape: (10, 2),
  terms: {
    &#39;Intercept&#39;: {
      type: intercept,
      cols: slice(0, 1, None),
      full_names: [&#39;Intercept&#39;]
    },
    &#39;scale(x)&#39;: {
      type: numeric,
      cols: slice(1, 2, None),
      full_names: [&#39;scale(x)&#39;]
    }
  }
)
</pre></div></div>
</div>
<p>And if we explore the design matrix for the common terms we notice the scaling of the new data used the mean and standard deviation <code class="docutils literal notranslate"><span class="pre">x</span></code> in the first dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>common_new.as_dataframe()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Intercept</th>
      <th>scale(x)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>-1.111751</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>-1.113193</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>-0.820436</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>-2.196410</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>-2.131558</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.0</td>
      <td>-1.244299</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.0</td>
      <td>-1.076445</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.0</td>
      <td>-0.859853</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.0</td>
      <td>-0.012279</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.0</td>
      <td>-0.351255</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Something similar can be done with the group-specific part.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>group_new = dm.group._evaluate_new_data(data2)
group_new
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
GroupEffectsMatrix(
  shape: (10, 6),
  terms: {
    &#39;1|g&#39;: {
      type: intercept,
      groups: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;],
      full_names: [&#39;1|g[A]&#39;, &#39;1|g[B]&#39;, &#39;1|g[C]&#39;],
      cols: slice(0, 3, None)
    },
    &#39;scale(x)|g&#39;: {
      type: numeric,
      groups: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;],
      full_names: [&#39;scale(x)|g[A]&#39;, &#39;scale(x)|g[B]&#39;, &#39;scale(x)|g[C]&#39;],
      cols: slice(3, 6, None)
    }
  }
)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>group_new[&quot;scale(x)|g&quot;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[-0.        , -1.11175056, -0.        ],
       [-0.        , -1.11319326, -0.        ],
       [-0.        , -0.        , -0.82043629],
       [-2.19640995, -0.        , -0.        ],
       [-0.        , -2.13155813, -0.        ],
       [-1.24429866, -0.        , -0.        ],
       [-1.07644467, -0.        , -0.        ],
       [-0.        , -0.85985319, -0.        ],
       [-0.01227858, -0.        , -0.        ],
       [-0.35125497, -0.        , -0.        ]])
</pre></div></div>
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Dependencies</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../api_reference.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">API Reference</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, The developers of Bambi.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.1.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>